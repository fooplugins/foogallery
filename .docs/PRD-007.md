# PRD-007: Harden Gutenberg REST Galleries Route

## Issue Summary
The Gutenberg REST route `foogallery/v1/galleries` returns all galleries with only an `edit_posts` capability check. In multisite, this can disclose galleries across sites to users who should only access their own site’s galleries.

## Affected Route
- `foogallery/v1/galleries` in `gutenberg/class-foogallery-rest-routes.php`

## Risk/Impact
- Cross-site information disclosure (gallery names, IDs, thumbnails) in multisite.

## Recommended Fix
1. Add multisite ownership check by limiting the query to the current blog’s galleries. Use `get_current_blog_id()` and store blog ID in gallery meta if needed, or ensure that galleries are created per-site and queried with a blog-specific context.
2. Replace `foogallery_get_all_galleries()` with a capability-aware query that only returns galleries the current user can `edit_post` (e.g., filter by `author` or loop results and drop unauthorized galleries).
3. Optionally add a stricter capability requirement (e.g., `edit_foogalleries` or `manage_options`) for this API.

## Files/Functions
- `gutenberg/class-foogallery-rest-routes.php`
  - `get_galleries_permissions_check()`
  - `get_galleries()`

## Implementation Notes
- If galleries do not store blog ID, consider using `switch_to_blog` when querying in multisite or storing `_foogallery_blog_id` on save.
- Ensure API response omits private galleries unless the current user can edit them.

## Acceptance Criteria
- Only galleries on the current site are returned.
- Users cannot access galleries they cannot edit.

## Test Plan
- Add `WP_UnitTestCase` REST tests calling `/foogallery/v1/galleries`.
- Assert `edit_posts` required (403 for subscriber).
- In multisite, create galleries on two blogs and assert results are limited to current blog.
