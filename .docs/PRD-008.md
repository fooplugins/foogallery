# PRD-008: Audit FooVideo Discount AJAX Support Submission

## Issue Summary
Support submission endpoint sends emails using user-supplied `message` without capability checks. It uses only a nonce check and accepts arbitrary message content.

## Affected Endpoint
- `foogallery_video_discount_offer_support` in `includes/compatibility/class-foovideo-compatibility.php`

## Risk/Impact
- Potential abuse for sending arbitrary email content as support messages.

## Recommended Fix
1. Add `current_user_can( 'manage_options' )` or at least `edit_posts` capability checks after nonce verification.
2. Sanitize and validate the message:
   - Use `sanitize_textarea_field( wp_unslash( $_POST['message'] ) )`.
   - Enforce a max length.
3. Return JSON response instead of plain text to standardize errors.

## Files/Functions
- `includes/compatibility/class-foovideo-compatibility.php`
  - `ajax_foogallery_video_discount_offer_support()`

## Acceptance Criteria
- Unauthorized users cannot trigger email sends.
- Message content is sanitized before sending.

## Test Plan
- Add `WP_Ajax_UnitTestCase` for `foogallery_video_discount_offer_support`.
- Assert subscriber receives 403.
- Assert admin request sanitizes message (use a filter on `wp_mail` to capture content).

## Final Cleanup
- After tests pass and the fix is complete, ask the user whether to delete this PRD and include the deletion in the final commit.
