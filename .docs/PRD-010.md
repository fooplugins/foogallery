# PRD-010: General Multisite Authorization Hardening

## Issue Summary
Multiple AJAX endpoints rely on nonces but do not verify that the requested gallery or attachment belongs to the current site in multisite environments. This can allow cross-site data access when a user is authenticated on another site.

## Scope
All AJAX endpoints that accept `foogallery_id`, `gallery_id`, or `attachment_id` should verify that the object belongs to the current site and that the current user can edit it.

## Recommended Fix
1. Introduce a helper for multisite validation, e.g.:
   - `foogallery_validate_site_ownership( $post_id )`
   - Check `get_current_blog_id()` against stored blog ID meta or use `get_blog_details` if post is from a different blog.
2. Apply the helper in all gallery/attachment AJAX handlers that read or mutate data.
3. Add capability checks using `current_user_can( 'edit_post', $post_id )`.

## Files/Functions
- Add helper in `includes/functions.php` or a new utility class.
- Apply to AJAX handlers across the plugin to ensure only posts from correct site are returned.

## Acceptance Criteria
- Requests from other sites in a multisite network are denied.
- Valid users on the same site continue to work normally.

## Test Plan
- Add multisite `WP_UnitTestCase` coverage for the shared ownership helper.
- Create a gallery on blog A, switch to blog B, and assert access is denied across each affected AJAX handler.
