# PRD-009: Review Pro WooCommerce nopriv Endpoint

## Issue Summary
The WooCommerce variation info AJAX endpoint is available to unauthenticated users (`wp_ajax_nopriv`). This may be intended for public product views but should be reviewed to ensure no sensitive data is exposed via gallery/attachment identifiers.

## Affected Endpoint
- `foogallery_product_variations` in `pro/includes/woocommerce/class-foogallery-pro-woocommerce.php`

## Risk/Impact
- Potential exposure of product info tied to gallery/attachment IDs.

## Recommended Fix
1. Confirm public access requirement; if not required, remove `wp_ajax_nopriv_...` registration.
2. If public access is required, ensure:
   - `gallery_id` and `attachment_id` are validated and correspond to published content.
   - Only public product data is returned.
   - A nonce is still required for nopriv calls (already present) and is not reusable across sites in multisite.

## Files/Functions
- `pro/includes/woocommerce/class-foogallery-pro-woocommerce.php`
  - `ajax_build_product_info()`

## Acceptance Criteria
- Endpoint exposes only intended public data.
- In multisite, nonces cannot be used cross-site.
- If responses switch to `wp_send_json_success`/`wp_send_json_error`, confirm the initiating JavaScript handler still parses the response correctly.

## Test Plan
- Add `WP_Ajax_UnitTestCase` for `foogallery_product_variations`.
- Assert responses only for published products/attachments and required nonce.
- For multisite, ensure a nonce from another site fails.